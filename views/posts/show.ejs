<%- include('../partials/header') %>

<section id="show-page" class="container-lg">
    <h1><%= post.title %></h1>
    <div><%= post.content %></div>
    <% const dateCreated = post.createdAt %><br>
    <div>Posted: <%= dateCreated.toLocaleDateString(); %></div><br>
    <div class="post-user"><img alt="avatar" src="<%= post.userAvatar %>" referrerpolicy="no-referrer">
      <%= post.userName %></div><br>

    
    <% if (user) { %>
      <h4>Edit Post</h4>
      <form action="posts/<%= post._id %>/edit" method="PUT">
        <div class="form-group">
          <label>Title</label>
          <input type="text" name="title" class="form-control" >
          <label>Post</label>
          <textarea name="contents" class="form-control" autocomplete="off" rows="3"><%= post.content %></textarea>
        </div>
        <button type="submit" name="button" class="btn btn-primary">Publish</button>
      </form>
    <% } %>
</section>

<h3>Comments</h3>
<% if (post.comments.length) { %>
  <% post.comments.forEach(function(p) { %>
    <section class="container-lg">
      <div class="comment-user"><img alt="avatar" src="<%= p.userAvatar %>" referrerpolicy="no-referrer"> 
        <%= p.userName %></div>
      <div class="text-end"><%= p.contents %></div> 
  <% if (user?._id.equals(p.user)) { %>
    <form action="/comments/<%= p._id %>?_method=DELETE" method="POST">
      <button type="submit">X</button>  
    </form>
    <% } %>
  </section> 
      <% }); %>
      <% } else { %>
        <h5>No Reviews Yet</h5>
        <% } %>

  <form id="add-comment" method="POST"
    action="/posts/<%= post._id %>/comments">
    <textarea name="contents"></textarea><br>
    <input type="submit" value="Add Comment">
  </form>

<%- include('../partials/footer') %>
